# FireFoundry SDK Core Concepts

*Generated by Claude*

This directory contains comprehensive guides to the foundational concepts of the FireFoundry Agent Bundle SDK:

- **Entities** - The structure and state management system
- **Bots** - AI-powered behaviors using LLMs  
- **Prompts** - Structured templates for LLM interactions
- **Agent Bundles** - Application containers that package entities, bots, and prompts into deployable services

Together, these components form the architecture that separates structure from behavior, enabling sophisticated AI workflows while maintaining clear organization and extensibility.

## Core Architecture Overview

The FireFoundry SDK follows a unique pattern where:
1. **Entities** represent business objects and their relationships in a persistent graph
2. **Bots** implement AI-powered behaviors through structured LLM interactions  
3. **Prompts** define the structure and content of LLM requests
4. **Runnable Entities** connect entities and bots, providing context from the entity graph to the bot
5. **Agent Bundles** package these components into deployable applications with HTTP APIs

This separation allows for clear division of responsibilities, independent development, and flexible composition of complex AI capabilities.

## Links and Further Reading

### Tutorials

For a hands-on, step-by-step introduction to the core components, start with these tutorials. They build on each other to teach the fundamentals of creating AI behaviors and applications.

- **[Building Your First Prompt](prompting_tutorial.md)** - A guided walkthrough of the Prompting Framework. Learn to create a dynamic, structured prompt from scratch.
- **[Building Your First Bot](bot_tutorial.md)** - Learn how to bring a prompt to life by wrapping it in a Bot that can handle validation, use tools, and recover from errors.
- **[Building Your First Agent Bundle](agent_bundle_tutorial.md)** - Learn how to create an agent bundle that packages your entities, bots, and prompts into a deployable application with custom API endpoints.

### Essential Guides

These are comprehensive reference guides that cover the architecture and advanced features of each core component in detail.

- **[Entity Modeling and Development](entities.md)** - Complete guide to the entity framework including graph-based relationships, runnable entities, job scheduling, and advanced patterns like waitable entities and work queues.

- **[Writing Bots](bots.md)** - Comprehensive bot development guide covering architecture, request-response flow, tool calls, error handling, progress tracking, and real-world implementation examples.

- **[Prompting Framework](prompting.md)** - Deep dive into the structured prompting system including template nodes, programmatic control flow, working memory integration, schema definitions, and best practices.

- **[Agent Bundles](agent_bundles.md)** - Complete reference for creating agent bundle applications, including the `@ApiEndpoint` decorator, initialization lifecycle, invocation patterns, platform service integration, and deployment best practices.

### Getting Started Recommendation

For newcomers to the FireFoundry SDK, we recommend this learning path:

1.  Start with the [Getting Started Guide](../agent_sdk_getting_started.md) for a complete, high-level tour of building an application with the Entity-Bot-Prompt pattern.
2.  Work through the **[Tutorials](#tutorials)** above to get a focused, hands-on understanding of creating prompts and bots.
3.  Dive into the **[Essential Guides](#essential-guides)** for a deep, architectural understanding of Entities, Bots, and Prompts.
4.  Explore the [Feature Guides](../feature_guides/) for specific advanced patterns and capabilities.

Each guide includes working code examples, best practices, and real-world implementation patterns from production FireFoundry applications.

## SDK v4 Changes

SDK v4 (`@firebrandanalytics/ff-agent-sdk` ^4.2.0-beta.0) introduces several breaking changes from earlier versions. If you are starting a new project, use v4 directly. If migrating, note the following:

### Agent Bundle Constructor

The `FFAgentBundle` constructor DTO now requires `application_id` and `type`:

```typescript
// v4
super(
  {
    id: APP_ID,
    application_id: APP_ID,  // NEW — required
    name: "MyBundle",
    type: "agent_bundle",     // NEW — required
    description: "...",
  },
  MyConstructors,
  createEntityClient(APP_ID) as any  // Replaces app_provider
);
```

**`app_provider` is removed** — use `createEntityClient(APP_ID)` instead. This requires the environment variables `REMOTE_ENTITY_SERVICE_URL` and `REMOTE_ENTITY_SERVICE_PORT` to be set.

### Bot Mixin Pattern

Bots now use `ComposeMixins` from `@firebrandanalytics/shared-utils`:

```typescript
import { ComposeMixins } from "@firebrandanalytics/shared-utils";
import { MixinBot, StructuredOutputBotMixin } from "@firebrandanalytics/ff-agent-sdk";

const MyBotBase = ComposeMixins(MixinBot, StructuredOutputBotMixin) as any;

export class MyBot extends MyBotBase {
  constructor(input: string) {
    super(
      [{ name: "MyBot", base_prompt_group: promptGroup, model_pool_name: "gemini_completion", static_args: {} }],
      [{ schema: MyBotSchema }]
    );
  }

  // REQUIRED — SDK throws at runtime if missing
  get_semantic_label_impl(_request: any): string {
    return "MyBot";
  }
}
```

Key changes:
- `ComposeMixins` is in `shared-utils`, not `ff-agent-sdk` — add `@firebrandanalytics/shared-utils` as a dependency
- Constructor takes two arrays: bot configs and structured output configs
- `get_semantic_label_impl()` is required on all bot subclasses (returns a string label for telemetry)

### Prompt Construction

Prompts use `StructuredPromptGroup` wrapping a `PromptGroup`:

```typescript
import { Prompt, PromptGroup, StructuredPromptGroup, PromptTemplateTextNode } from "@firebrandanalytics/ff-agent-sdk";

const systemPrompt = new Prompt("system", {});
systemPrompt.add_section(new PromptTemplateTextNode({ content: "..." }));

const promptGroup = new StructuredPromptGroup({
  base: new PromptGroup([{ name: "system", prompt: systemPrompt }]),
  input: new PromptGroup([]),
});
```

### BotRequest

`BotRequest` now requires a `context` field:

```typescript
import { BotRequest, Context } from "@firebrandanalytics/ff-agent-sdk";

const request = new BotRequest({
  id: `req-${Date.now()}`,
  input: "...",
  args: {},
  context: new Context(),  // NEW — required
});
```

### Entity Changes

- `agent_bundle_id` replaces `app_id` in entity DTOs
- Entity-service system application (`a0000000-0000-0000-0000-000000000000`) must be seeded manually

### Required Package Versions

| Package | Version |
|---------|---------|
| `@firebrandanalytics/ff-agent-sdk` | ^4.2.0-beta.0 |
| `@firebrandanalytics/shared-types` | ^2.1.1 |
| `@firebrandanalytics/shared-utils` | ^4.2.0-beta.3 |
| `zod` | ^3.22.4 |